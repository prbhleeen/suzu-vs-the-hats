<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Suzu vs The Hats | Level 6: Reverse Chaos</title>
  <link rel="icon" type="png" href="icon.png" />

<style>
:root {
    --bg-color: #fce4ec;
    --wall-color: #ffb6c1;
    --border-color: #ff69b4;
    --player-color: #9c27b0;
    --accent-color: #800040;
    --text-color: #800040;
}
body {
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh; background-color: var(--bg-color);
    font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    color: var(--text-color); overflow: hidden;
}
#game-container {
    position: relative; background: #fff0f5;
    border: 4px solid var(--border-color); border-radius: 12px;
    overflow: hidden; box-sizing: content-box;
}
#scoreboard, #timer {
    position: absolute; top: 8px; font-size: 1rem; font-weight: bold;
    color: var(--accent-color); text-shadow: 1px 1px #ffb6c1;
    user-select: none; z-index: 12; padding: 5px 10px;
    background: #ffe0f0cc; border-radius: 8px;
}
#scoreboard { left: 10px; }
#timer { right: 10px; }
.wall {
    position: absolute; background-color: var(--wall-color);
    border: 2px solid var(--border-color); box-sizing: border-box;
}
.item {
    position: absolute; font-size: 28px; display: flex;
    justify-content: center; align-items: center;
    opacity: 0; transition: opacity 0.5s ease, transform 0.3s ease;
}
.item.visible { opacity: 1; }
.item.collected { transform: scale(1.5); opacity: 0; }
#player {
    position: absolute; z-index: 10;
    background-image: url('sunaina.png');
    background-size: cover; background-position: center;
    border-radius: 50%; box-shadow: 0 0 10px rgba(156,39,176,0.7);
}
.modal {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: rgba(255,224,230,0.85); backdrop-filter: blur(5px);
    display:flex; flex-direction: column; justify-content: center;
    align-items:center; text-align:center; z-index:100; padding:20px;
    box-sizing:border-box; opacity:1; transition: opacity 0.5s ease;
}
.modal.hidden { opacity:0; pointer-events:none; }
.modal h1 { font-size:1.8rem; margin-bottom:20px; color:var(--accent-color); }
.modal p { font-size:1rem; line-height:1.6; max-width:400px; margin-bottom:30px; }
.modal button {
    font-family: inherit; font-size:1.2rem; padding:15px 30px;
    border:none; border-radius:50px; background:#ff3d84; color:white;
    cursor:pointer; transition: transform 0.2s ease, background-color 0.2s ease;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.modal button:hover { transform: scale(1.05); background: var(--border-color); }
</style>
</head>
<body>
<div id="game-container">
    <div id="scoreboard">Hats: 0/10</div>
    <div id="timer">Time: 60</div>

    <div id="intro-screen" class="modal">
        <h1>Level 6: Reverse Controls Madness!</h1>
        <p>Arrow keys reverse every 10 seconds! Collect all 10 hats to win! There may be fake hats. ðŸ˜ˆ</p>
        <button id="start-btn">Start Challenge</button>
    </div>

    <div id="end-screen" class="modal hidden">
        <h1 id="end-title">You Won!</h1>
        <p id="end-message">Amazing memory! You collected all the hats!</p>
        <button id="next-level-btn">Next Level</button>
    </div>

    <div id="maze-container"></div>
    <div id="items-container"></div>
    <div id="player"></div>
</div>

<script>
const gameContainer = document.getElementById('game-container');
const mazeContainer = document.getElementById('maze-container');
const itemsContainer = document.getElementById('items-container');
const playerElement = document.getElementById('player');
const scoreboard = document.getElementById('scoreboard');
const timerDisplay = document.getElementById('timer');
const introScreen = document.getElementById('intro-screen');
const endScreen = document.getElementById('end-screen');
const startBtn = document.getElementById('start-btn');
const nextLevelBtn = document.getElementById('next-level-btn');
const endTitle = document.getElementById('end-title');
const endMessage = document.getElementById('end-message');

const MAZE_COLS = 15;
const MAZE_ROWS = 11;
const CELL_SIZE = 50;
let PLAYER_SPEED = 4;
const TOTAL_HATS = 10;
const GAME_TIME_SECONDS = 60;

const mazeLayout = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,0,1,1,0,1,0,1],
    [1,0,0,0,0,1,0,0,0,0,0,0,1,0,1],
    [1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,0,1,1,0,1,1,0,1,1,0,0,1],
    [1,0,1,0,0,0,0,1,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
];

let state = {};
let controlsReversed = false;

function setupGame() {
    gameContainer.style.width = `${MAZE_COLS * CELL_SIZE}px`;
    gameContainer.style.height = `${MAZE_ROWS * CELL_SIZE}px`;
    drawMaze();

    const emptyCells = [];
    for (let y = 0; y < MAZE_ROWS; y++) {
        for (let x = 0; x < MAZE_COLS; x++) {
            if (mazeLayout[y][x] === 0) emptyCells.push({ x, y });
        }
    }
    emptyCells.sort(() => Math.random() - 0.5);

    state = {
        player: { x: CELL_SIZE * 1.5, y: CELL_SIZE * 1.5, size: CELL_SIZE * 0.8 },
        keys: {},
        items: [],
        hatsCollected: 0,
        timeLeft: GAME_TIME_SECONDS,
        gameActive: false,
        gameOver: false,
        animationFrameId: null,
        timerInterval: null
    };

    for (let i = 0; i < TOTAL_HATS; i++) {
        const cell = emptyCells.pop();
        if (cell) createItem(cell.x, cell.y, 'hat');
    }

    renderPlayer();
    updateUI();
}

function drawMaze() {
    mazeContainer.innerHTML = '';
    for (let y = 0; y < MAZE_ROWS; y++) {
        for (let x = 0; x < MAZE_COLS; x++) {
            if (mazeLayout[y][x] === 1) {
                const wall = document.createElement('div');
                wall.className = 'wall';
                wall.style.width = wall.style.height = CELL_SIZE + 'px';
                wall.style.left = x * CELL_SIZE + 'px';
                wall.style.top = y * CELL_SIZE + 'px';
                mazeContainer.appendChild(wall);
            }
        }
    }
}

function createItem(gridX, gridY, type) {
    const item = document.createElement('img');
    item.src = 'hat.png'; // use your image here
    item.className = 'item visible';
    item.style.width = item.style.height = CELL_SIZE * 0.8 + 'px';
    item.style.left = gridX * CELL_SIZE + CELL_SIZE * 0.1 + 'px';
    item.style.top = gridY * CELL_SIZE + CELL_SIZE * 0.1 + 'px';
    itemsContainer.appendChild(item);
    state.items.push({
        element: item,
        x: gridX * CELL_SIZE + CELL_SIZE / 2,
        y: gridY * CELL_SIZE + CELL_SIZE / 2,
        size: CELL_SIZE * 0.8,
        type: type,
        collected: false
    });
}

function gameLoop() {
    if (!state.gameActive) return;
    movePlayer();
    checkItemCollision();
    renderPlayer();
    state.animationFrameId = requestAnimationFrame(gameLoop);
}

function movePlayer() {
    const { player, keys } = state;
    let nextX = player.x, nextY = player.y;
    let speed = PLAYER_SPEED;
    if (controlsReversed) speed *= -1;

    if (keys['ArrowUp']) nextY -= speed;
    if (keys['ArrowDown']) nextY += speed;
    if (keys['ArrowLeft']) nextX -= speed;
    if (keys['ArrowRight']) nextX += speed;

    if (!isCollidingWithWall(nextX, player.y, player.size)) player.x = nextX;
    if (!isCollidingWithWall(player.x, nextY, player.size)) player.y = nextY;
}

function isCollidingWithWall(x, y, size) {
    const half = size / 2;
    const corners = [
        { x: x - half, y: y - half },
        { x: x + half, y: y - half },
        { x: x - half, y: y + half },
        { x: x + half, y: y + half }
    ];
    for (const c of corners) {
        const gridX = Math.floor(c.x / CELL_SIZE);
        const gridY = Math.floor(c.y / CELL_SIZE);
        if (
            gridX < 0 ||
            gridX >= MAZE_COLS ||
            gridY < 0 ||
            gridY >= MAZE_ROWS ||
            mazeLayout[gridY][gridX] === 1
        )
            return true;
    }
    return false;
}

function renderPlayer() {
    const p = state.player;
    playerElement.style.width = playerElement.style.height = p.size + 'px';
    playerElement.style.transform = `translate(${p.x - p.size / 2}px, ${p.y - p.size / 2}px)`;
}

function checkItemCollision() {
    const playerCenter = { x: state.player.x, y: state.player.y };
    for (const item of state.items) {
        if (!item.collected) {
            const dx = playerCenter.x - item.x;
            const dy = playerCenter.y - item.y;
            if (Math.sqrt(dx * dx + dy * dy) < (state.player.size / 2 + item.size / 2) * 0.9) {
                handleItemCollection(item);
            }
        }
    }
}

function handleItemCollection(item) {
    item.collected = true;
    item.element.classList.add('collected');
    setTimeout(() => item.element.remove(), 300);
    if (item.type === 'hat') {
        state.hatsCollected++;
        if (state.hatsCollected === TOTAL_HATS) endGame(true);
    }
    updateUI();
}

function startGame() {
    setupGame();
    introScreen.classList.add('hidden');
    state.gameActive = true;
    state.timerInterval = setInterval(() => {
        state.timeLeft--;
        updateUI();
        if (state.timeLeft <= 0) endGame(false);
    }, 1000);

    setInterval(() => (controlsReversed = !controlsReversed), 10000);
    gameLoop();
}

function endGame(win) {
    state.gameActive = false;
    clearInterval(state.timerInterval);
    cancelAnimationFrame(state.animationFrameId);
    if (win) {
        endTitle.textContent = 'You Won! ðŸŽ‰';
        endMessage.textContent = 'Amazing! You collected all the hats!';
    } else {
        endTitle.textContent = "Time's Up! ðŸ’”";
        endMessage.textContent = 'Better luck next time!';
    }
    endScreen.classList.remove('hidden');
}

function updateUI() {
    scoreboard.textContent = `Hats: ${state.hatsCollected}/${TOTAL_HATS}`;
    timerDisplay.textContent = `Time: ${state.timeLeft}`;
}

window.addEventListener('keydown', e => {
    state.keys[e.key] = true;
    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) e.preventDefault();
});
window.addEventListener('keyup', e => (state.keys[e.key] = false));

startBtn.addEventListener('click', startGame);
nextLevelBtn.addEventListener('click', () => (window.location.href = 'level7.html'));

setupGame();
</script>
</script>
</body>
</html>
